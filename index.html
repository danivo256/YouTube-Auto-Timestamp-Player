<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>YouTube Timestamp Player Pro</title>

<style>
body {
  font-family: Arial, sans-serif;
  background: #000;
  color: #fff;
  padding: 12px;
}

h3 { color: #0f9dff; }

input, textarea, button {
  width: 100%;
  margin: 6px 0;
  padding: 8px;
  font-size: 14px;
  background: #000;
  color: #fff;
  border: 1px solid #333;
}

textarea { min-height: 120px; }

button { cursor: pointer; }

#buttons {
  display: flex;
  flex-wrap: wrap;
  gap: 6px;
  margin-top: 10px;
}

.rangeBtn {
  width: auto;
  padding: 6px 10px;
  font-size: 12px;
  border-radius: 6px;
  border: 1px solid #333;
  background: #050505;
  color: #aaa;
}

.rangeBtn.active {
  background: #00e5ff;
  color: #000;
  font-weight: bold;
  border: 2px solid #fff;
  box-shadow: 0 0 12px #00e5ff;
}

#player { margin-top: 10px; }

.historyItem {
  border: 1px solid #222;
  padding: 8px;
  margin-top: 6px;
  cursor: pointer;
  background: #050505;
}

.historyItem:hover {
  background: #0a0a0a;
}
</style>
</head>
<body>

<h3>YouTube Timestamp Player</h3>

<input id="ytlink" placeholder="Paste YouTube link">

<textarea id="ranges" placeholder=
"00:00:00 - 00:05:00
00:06:00 - 00:10:00"></textarea>

<button onclick="start()">Load Video</button>

<div id="buttons"></div>
<div id="player"></div>

<h3>History</h3>
<div id="history"></div>

<script src="https://www.youtube.com/iframe_api"></script>

<script>
let player;
let segments = [];
let index = -1;
let checker = null;
let currentTitle = "";

function extractVideoId(url) {
  let m = url.match(/(v=|\/)([0-9A-Za-z_-]{11})/);
  return m ? m[2] : null;
}

function toSeconds(t) {
  let p = t.trim().split(":").map(Number);
  return p[0]*3600 + p[1]*60 + p[2];
}

function forceLandscape() {
  if (document.documentElement.requestFullscreen) {
    document.documentElement.requestFullscreen().then(() => {
      if (screen.orientation && screen.orientation.lock) {
        screen.orientation.lock("landscape").catch(()=>{});
      }
    }).catch(()=>{});
  }
}

function clearHighlight() {
  document.querySelectorAll(".rangeBtn").forEach(b => b.classList.remove("active"));
}

function highlight(i) {
  clearHighlight();
  let btns = document.querySelectorAll(".rangeBtn");
  if (btns[i]) btns[i].classList.add("active");
}

function start() {
  let link = document.getElementById("ytlink").value.trim();
  let vid = extractVideoId(link);
  if (!vid) { alert("Invalid YouTube link"); return; }

  segments = [];
  index = -1;

  let lines = document.getElementById("ranges").value.trim().split("\n");
  lines.forEach(l => {
    if (!l.includes("-")) return;
    let p = l.split("-");
    segments.push([toSeconds(p[0]), toSeconds(p[1]), l.trim()]);
  });

  if (segments.length === 0) { alert("No valid timestamps"); return; }

  if (player) player.destroy();
  player = new YT.Player('player', {
    videoId: vid,
    events: { 'onReady': onReady }
  });

  makeButtons();
}

function onReady() {
  player.setPlaybackRate(2);
  forceLandscape();
  currentTitle = player.getVideoData().title || "Unknown title";
  saveHistory();
}

function makeButtons() {
  let box = document.getElementById("buttons");
  box.innerHTML = "";

  segments.forEach((seg, i) => {
    let b = document.createElement("button");
    b.className = "rangeBtn";
    b.textContent = seg[2];
    b.onclick = () => playFrom(i);
    box.appendChild(b);
  });
}

function playFrom(i) {
  index = i;
  playNext();
}

function playNext() {
  if (index >= segments.length) return;

  highlight(index);

  let s = segments[index][0];
  let e = segments[index][1];

  player.setPlaybackRate(2);
  player.seekTo(s, true);
  player.playVideo();

  if (checker) clearInterval(checker);
  checker = setInterval(() => {
    if (player.getCurrentTime() >= e) {
      player.pauseVideo();
      clearInterval(checker);
      index++;
      setTimeout(playNext, 300);
    }
  }, 200);
}

/* ---------- HISTORY SYSTEM ---------- */

function saveHistory() {
  let link = document.getElementById("ytlink").value.trim();
  let ranges = document.getElementById("ranges").value.trim();

  if (!link || !ranges) return;

  let data = JSON.parse(localStorage.getItem("yt_ts_history") || "[]");

  data = data.filter(d => !(d.link === link && d.ranges === ranges));

  data.unshift({
    link: link,
    title: currentTitle,
    ranges: ranges,
    time: Date.now()
  });

  if (data.length > 15) data.length = 15;

  localStorage.setItem("yt_ts_history", JSON.stringify(data));
  renderHistory();
}

function renderHistory() {
  let box = document.getElementById("history");
  box.innerHTML = "";

  let data = JSON.parse(localStorage.getItem("yt_ts_history") || "[]");

  data.forEach(d => {
    let div = document.createElement("div");
    div.className = "historyItem";
    div.innerHTML = "<b>" + d.title + "</b><br><small>" + d.link + "</small>";
    div.onclick = () => {
      document.getElementById("ytlink").value = d.link;
      document.getElementById("ranges").value = d.ranges;
      start();
    };
    box.appendChild(div);
  });
}

renderHistory();
</script>

</body>
</html>
