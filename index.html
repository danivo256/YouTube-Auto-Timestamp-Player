<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>YouTube Timestamp Player Pro</title>

<style>
body { font-family: Arial, sans-serif; padding: 12px; }

input, textarea, button {
  width: 100%;
  margin: 6px 0;
  padding: 8px;
  font-size: 14px;
}

#buttons {
  display: flex;
  flex-wrap: wrap;
  gap: 6px;
  margin-top: 10px;
}

.rangeBtn {
  width: auto;
  padding: 6px 10px;
  font-size: 12px;
  cursor: pointer;
  border: 1px solid #888;
  background: #f2f2f2;
}

.rangeBtn.active {
  background: #222;
  color: white;
  border-color: #000;
}

#player { margin-top: 10px; max-width: 100%; }
</style>
</head>
<body>

<h3>YouTube Auto Timestamp Player</h3>

<input id="ytlink" placeholder="Paste YouTube link">

<textarea id="ranges" rows="7" placeholder=
"00:00:00 - 00:05:00
00:06:00 - 00:10:00"></textarea>

<button onclick="start()">Load Video</button>
<button onclick="autoPlay()">Auto Play All</button>

<div id="buttons"></div>
<div id="player"></div>

<script src="https://www.youtube.com/iframe_api"></script>

<script>
let player;
let segments = [];
let index = -1;
let checker = null;

function extractVideoId(url) {
  let m = url.match(/(v=|\/)([0-9A-Za-z_-]{11})/);
  return m ? m[2] : null;
}

function toSeconds(t) {
  let p = t.trim().split(":").map(Number);
  return p[0]*3600 + p[1]*60 + p[2];
}

function forceLandscape() {
  if (document.documentElement.requestFullscreen) {
    document.documentElement.requestFullscreen().then(() => {
      if (screen.orientation && screen.orientation.lock) {
        screen.orientation.lock("landscape").catch(()=>{});
      }
    }).catch(()=>{});
  }
}

function clearHighlight() {
  document.querySelectorAll(".rangeBtn").forEach(b => b.classList.remove("active"));
}

function highlight(i) {
  clearHighlight();
  let btns = document.querySelectorAll(".rangeBtn");
  if (btns[i]) btns[i].classList.add("active");
}

function start() {
  let link = document.getElementById("ytlink").value;
  let vid = extractVideoId(link);
  if (!vid) { alert("Invalid YouTube link"); return; }

  segments = [];
  index = -1;

  let lines = document.getElementById("ranges").value.trim().split("\n");
  lines.forEach(l => {
    if (!l.includes("-")) return;
    let p = l.split("-");
    segments.push([toSeconds(p[0]), toSeconds(p[1]), l.trim()]);
  });

  if (segments.length === 0) { alert("No valid timestamps"); return; }

  if (player) player.destroy();
  player = new YT.Player('player', {
    videoId: vid,
    events: { 'onReady': () => {
      player.setPlaybackRate(2);
      forceLandscape();
    }}
  });

  makeButtons();
}

function makeButtons() {
  let box = document.getElementById("buttons");
  box.innerHTML = "";

  segments.forEach((seg, i) => {
    let b = document.createElement("button");
    b.className = "rangeBtn";
    b.textContent = seg[2];
    b.onclick = () => playFrom(i);
    box.appendChild(b);
  });
}

function playFrom(i) {
  index = i;
  playNext();
}

function autoPlay() {
  index = 0;
  playNext();
}

function playNext() {
  if (index >= segments.length) return;

  highlight(index);

  let s = segments[index][0];
  let e = segments[index][1];

  player.setPlaybackRate(2);
  player.seekTo(s, true);
  player.playVideo();

  if (checker) clearInterval(checker);
  checker = setInterval(() => {
    if (player.getCurrentTime() >= e) {
      player.pauseVideo();
      clearInterval(checker);
      index++;
      setTimeout(playNext, 300);
    }
  }, 200);
}
</script>

</body>
</html>
